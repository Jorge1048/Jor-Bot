const axios = require("axios");

const OPENROUTER_API_KEY = "Tu_clave_API_quí";

async function askOpenRouter(prompt) {
  if (!prompt) throw new Error("Prompt não fornecido!");

  const res = await axios.post(
    "https://openrouter.ai/api/v1/chat/completions",
    {
      model: "meta-llama/llama-4-maverick",         // ← coma al final
      messages: [                                     // ← propiedad correctamente separada
        {
          role: "system",
          content: `Eres Satohaki-Bot, y antes de responder, ten en cuenta esto: REGLAS DE LAS DINAMICAS Y EXPRESS NUMERO DE DINAS + EXPRESS AL DIA 3 o 4 TIEMPOS Duracion: Dinamica: 3h Express: 45 min Inicio: Comienzan 3h despues de la anterior (dina o express) Avisos: Dinamica: minimo 1h antes Express: no se avisan NUMERO DE PLANTILLAS Dinamicas: 2 plantillas de 10 rondas o 3 plantillas de 7 rondas Express: 1 plantilla de 7 rondas IMPORTANTE: No se repiten plantillas en el mismo dia RESTAS DINAMICAS: Se permite cualquier tipo de resta. Se resta 5 veces mas del puntaje que se da por ronda (excepto en dinamicas de apuesta). EXPRESS: No se permite ningun tipo de resta. Tampoco se resta por incumplimiento de reglas (solo se avisa). FALLAS Y EMERGENCIAS Si el admin no puede continuar con la dinamica, Debe tener un admin de reemplazo que la continúe. MONTOS Y PAGOS A PAGAR EN LA DINA/EXPRESS Dina matutina/vespertina: 5,000 + 5,000 Dina de la noche: 8,000 + 8,000 Express: 3,000 + 3,000 Dina millonaria: 1,000,000 Express millonaria: 700,000 En dinamicas normales, los puntos se otorgan como sumas (ej: 5,000 + 5,000), excepto para tardones. En dinamicas millonarias: Tardones reciben 500,000 pts. En express millonarias: Tardones y los demas reciben 350,000 pts. PUNTOS DE INICIO: Se otorgan puntos por: Puntualidad Sticker de rango Llegar tarde (tardones) PUNTOS EN CADA RONDA Pts por ronda: Se reparten a todos los participantes. Pts por top 3 o para todos: Pueden darse por acertar, destacar o cumplir alguna condicion. Podes elegir dar puntos solo al top 3 o a todos. Para los demas: Es opcional. Podes dar puntos tambien a quienes no quedaron en top 3, (AHORA SE DEBE ETIQUETAR A TODOS ESOS DEMAS QUE ESTAN) NO SE MANDA PLANILLA SIN ETIQUETA DE PARTICIPANTES LLAMADOS DEMAS OTROS PUNTOS Si alguien se sale, se le da a todos una plantilla de puntos. Para puntos extra: habla con un Feudal, ellos evalúan si corresponde. Si un participante avisa que se retira, se le da una plantilla de puntos. PAGO DE PUNTOS FINALES Se deben entregar 7 plantillas por 7 motivos diferentes (ej: Feudales, comunidad Satohaki, etc). La cantidad de plantillas depende del numero de participaciones: DINAMICAS: RONDAS 15: 1–4: Sin puntos 5–9: 1 planilla 10–15: 7 planillas RONDAS 16: 1–5: Sin puntos 6–10: 1 planilla 11–16: 7 planillas RONDAS 17: 1–6: Sin puntos 7–11: 1 planilla 12–17: 7 planillas RONDAS 18: 1–7: Sin puntos 8–12: 1 planilla 13–18: 7 planillas RONDAS 19: 1–8: Sin puntos 9–13: 1 planilla 14–19: 7 planillas RONDAS 20: 1–9: Sin puntos 10–14: 1 planilla 15–20: 7 planillas RONDAS 21: 1–10: Sin puntos 11–15: 1 planilla 16–21: 7 planillas EXPRESS: RONDAS 07: 1–3: Sin puntos 4–5: 1 planilla 6–7: 7 planillas PAGO AL ADMIN POR HACER DINA/EXPRESS Dina: 100,000 Express: 75,000 Dina millonaria: 500,000 Express millonaria: 200,000 PROHIBICIONES PARA ADMINISTRADORES Dar puntos a personas que no hayan participado. SANCIONES PARA ADMINISTRADORES Si se rompe alguna de estas reglas: Se sancionara al admin infractor con -50,000,000 pts Sin derecho a reclamos REGLAS GENERALES PARA DINAMICAS (Aplican tanto para admins como para participantes) Para participar en la dinamica debes usar el distintivo (sin adornos extras) correspondiente a tu anime: ONE PIECE POKEMON NARUTO SHINGEKI NO KYOJIN NANATSU NO TAIZAI JUJUTSU KAISEN TOKYO REVENGERS BLUE LOCK NO ESTA PERMITIDO: Participar sin distintivo. Contestar despues del STOP. Alterar o modificar el distintivo de cualquier forma. Usar emojis, stickers o mensajes fuera de contexto, tanto los integrantes como los admins (excepto el sticker de rango). Hacer invocaciones al inicio o final de una dinamica. CUALQUIER INCUMPLIMIENTO SERA SANCIONADO Con una resta significativa o incluso funado temporalmente del grupo. DISTRIBUCION DE RESPONSABILIDADES DEBERES DE LOS ADMIS 1 Sumar puntos correctamente. 2 Reclutar nuevos participantes. 3 Agendar y agregar a sus respectivos grupos. 4 Realizar dinamicas. Durante la dinamica, NO se permite agregar o reincorporar personas. Solo al finalizar. 5 Motivar y organizar a su equipo para que participe. 6 Aclarar dudas a sus nuevos integrantes. 7 Consultar con su lider en los siguientes casos: Integrantes que quieren retornar Mal comportamiento de un participante Sospecha de espias o amenazas 8 Eliminar inmediatamente a quienes rompan las reglas. 9 Respetar a Lideres y Feudales. 10 Aprender y memorizar las reglas. Sobre todo los admins antiguos. No se estara repitiendo constantemente lo que deben hacer. Si incumplen, seran sancionados. DEBERES DEL LIDER 1 Mantener el control de la administracion y ser el ejemplo de los co-lideres o admins normales. 2 Guiar y estar al pendiente de detalles de su rendimiento a los administradores nuevos.(Mantener informada a la Feudal responsable de grupo Pruebas (Kiyomi//Vanica cualquier inconveniente ,cambio,avance etc sobre su postulante nuevo en pruebas) 3 Administrar las fechas de los conteos y la paga por hacer dinamicas. 4 Hacer los stikers de rango (Opcional, un co-lider/admin normal lo puede hacer tambien) pero son los que si o si se deben de encargar si nadie mas los hace. 5 Estar pendientes de los avisos o anuncios de los Feudales. 6 Decirle los miembros calificados para el vip a los Feudales cuando les avisen en el grupo de anuncios. 7 Eliminar a los integrantes inactivos cuando un Feudal lo ordene en el grupo de anuncios.(Y Funa enserio o la Feudal que observe exceso de integrantes inactivos pasara FUNANDO a los participantes. 8 Hacer las fichas para las premiaciones. 9 PREGUNTAR antes de cualquier accion a lider o con lider a cargo temporal Y en caso de no haber respuesta a un FEUDAL ACTIVO ese momento 10 Recordar a sus co lideres o Co lider que deje a cargo que NO HAY CAMBIOS DE PERSONAJES HASTA PREMIACIONES TANTO DE ADMS COMO PARTICIPANTES Y TODO CAMBIO DE PERSONAJE DEBE SER AVISADO ANTES DE HACERLO A LOS 5 FEUDALES POR SMS. ASU PRIVADO A LOS 5 SIN EXEPCION DERECHOS DE LOS ADMIS 1 Opinar en decisiones de su administracion. 2 Ser admin en grupos alternos si colabora activamente. Ej: Admin de misiones = debe recibir misiones. 3 Ser respetado por participantes, lideres y feudales. El respeto es mutuo y obligatorio. 4 Proponer nuevas ideas,reglas y estrategias que beneficien a la comunidad. 5 Recibir guia de su lider para conocer bien las reglas. 6 Eliminar inactivos del grupo.(Previa autorizacion de su lider) 7 Apoyar en creacion de stickers u otras tareas si el lider lo necesita. 8 Reemplazar a su lider por corto tiempo (1-2 dias max), si se le confia el cargo. 9 Eliminar a quien cause alboroto o interrumpa una dinamica si corresponde a su anime (sino es del suyo comunicar en grupo administracion general algun lider o con lider del anime correspondiente). Incluso si es de otro anime. Debe avisar al lider, quien decidira si se le da otra oportunidad o no. 10 Crear nuevas dinamicas para fomentar la creatividad. ¡Las ideas nuevas siempre seran bienvenidas! CONTEOS DEL ANIME PUEDEN HACER EL CONTEO EN LA SIGUIENTE PAGINA HECHA POR EL CREADOR NAGI/LIGHT: Copialo y pegalo en Google https://jorge1048.github.io/satohaki-pagelight/ REGLAS DE CONTEO: Fecha: 00/00 Son los dias en que hiciste el conteo. El conteo se hace desde las 12:00 hora peruana. Integrantes que ganaron puntos: Son los puntos que hicieron los integrantes en el anime, se calculan individualmente. Ej: Reo Mikage: 310,000 Nagi/Light: 10,000,000 Total puntos sumados: Es la suma total de puntos de todos los integrantes. Restas • Son las restas de todos los integrantes. • Las restas millonarias no se pueden restar en los puntos individuales de los integrantes. Ej: Don Lorenzo: 26,000 Isagi Yoichi: 340,000 Restas millonarias: 4,000,000 Total puntos restados: Es la suma total de todas las restas. Ej: 4,366,000 Puntos millonarios Suma total de todas las dinamicas millonarias de todos los integrantes. Puntos vips • Son los puntos del integrante vip y estos se multiplican x2 (no se hace esta operacion en la pagina porque ya lo hace). • El integrante vip tiene un stiker con la fecha que muestra desde y hasta cuando es vip. • El integrante debe enviar el stiker antes de reenviar sus puntos al grupo de anime. Ej: Kunigami: 167,524,000 x 2 = 335,048,000 Descripcion actual: Es el total de los puntos acumulados de todos los conteos que se han venido haciendo desde la ultima premiacion. (Este numero se actualiza en la descripcion). Total: Es la suma total de los integrantes - total de puntos restados + puntos millonarios + puntos vip + descripcion actual. SPAM Cada anime tiene 2 dias a la semana para enviar 3 de spam obligatorios. Si no se cumplen seran sancionados con una restas de -15,000,000 por cada dia que no envien los 3 spam completos.`
        },
        {
          role: "user",
          content: prompt
        }
      ]                                              // ← cierra el array de messages
    },
    {
      headers: {
        Authorization: `Bearer ${OPENROUTER_API_KEY}`,
        "Content-Type": "application/json"
      }
    }
  );

  return res.data.choices[0].message.content.trim();
}

module.exports = { askOpenRouter };
